**阶段1:开发与资源准备**

1. 热更新的内容规划
   - 确定哪些内容可能频繁改动（美术资源，逻辑代码）
2. 资源分组和依赖管理
   - AB包需要独立分块，并减少跨包依赖
   - 公共的资源可以独立一个包，避免重复
   - 依赖分析工具：用 Unity 的 AssetBundle Browser 或 Addressables 分析依赖链
3. 配置表
   - 配置表从客户端下载与本地版本号进行对比，有需要热更的再进行下载



**阶段2:打包与版本生成**

1. 打包AB资源

2. 加密处理

   资源加密可以用（XOR,AES,XXTEA）进行加密

   加密时保留文件头标记，可以避免重复加密也可以在运行时候识别是否需要解密

   配置表和代码也需要加密

3. 生成版本清单

   文件名，文件大小，文件MD5，依赖列表

   ```
   {
     "ui.bundle": { "md5": "a1b2c3", "size": 1024, "deps": ["common.bundle"], "priority": 1, "type": "bundle" }
   }
   ```

   

**阶段3:客户端启动检测（差异化下载）**

1. 加载本地版本清单

   - 优先读取上一次热更的版本文件。
   - 如果没有则用包内版本清单。

2. 下载远程版本清单

   - GET 请求 manifest.json。
   - 对比远程与本地 MD5 → 生成差异列表。
   - **只下载有改动的资源**（MD5 不同或本地缺失）。

3. 优先级队列下载

   - 启动必需（如启动 UI、主角模型、配置表）优先下载。
   - 其余在后台慢速下载，避免卡加载界面。

   

**阶段4:下载与解密**

1. 断点续传
   - 下载中断时，记录已下载字节，支持续传。
   - 下载完成后立即做 MD5 校验，失败则重下。
2. 下载后解密
   -   先从临时目录解密到目标目录（防止中途覆盖旧文件）。
   -   解密失败时不替换旧版本，避免加载错误资源。
3. 配置表更新
   - 配置表下载后解密 → 覆盖旧文件 → 解析成内存数据结构。
   - 解析异常时回退旧版本。



[打包AB/配置/DLL] → [加密] → [生成Manifest + MD5] → [上传CDN]
     ↓
[客户端启动] → [加载本地Manifest] → [下载远程Manifest] → [MD5差异比对]
     ↓
[生成下载列表] → [优先级队列下载] → [解密到临时目录] → [校验MD5]
     ↓
[替换旧文件] → [加载资源/配置表/代码] → [运行游戏]